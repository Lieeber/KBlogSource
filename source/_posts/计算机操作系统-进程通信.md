---
title: 进程通信
tags:
  - 进程
categories:
  - 操作系统
date: 2017-05-05 18:23:15
---
### 信号量机制作为通信工具的缺陷
1. 效率低：生产者每次只向缓存区投放一个消息，消费者每次只能从缓存区取得一个消息。
2. 通信对用户不透明。
<!-- more -->

### 进程通信的类型
1. 共享存储系统
    1. 基于共享数据结构的通信方式
        * 通信方式低效，只适用于传递相对少量的数据
    2. 基于共享存储区的通信方式
        * 在存储器中划出一块共享存储区，诸进程可通过对共享存储区中数据的读和写来通信，这种通信属于高级通信。
2. 消息传递系统
    1. 进程间的数据交换以格式化的消息为单位，把message称作报文。可分为直接通信方式和间接通信方式。
3. 管道通信
    1. 用于连接一个读进程和一个写进程以实现它们之间通信的一个共享文件，有名pipe文件。
    2. 为了协调双方通信，管道机制必须提供以下三方面的协调能力
        1. 互斥：一个进程正在对pipe执行读写操作时，其他进程必须等待
        2. 同步：当写(输入)进程把一定数量(如 4 KB)的数据写入 pipe，便去睡眠等待，直到读(输出)进程取走数据后，再把它唤醒。当读进程读一空pip 时，也应睡眠等待，直至写进程将数据写入管道后，才将之唤醒。
        3. 确定对方是否存在：只有确定了对方存在时，才能进行通信

### 消息传递通信的实现方法
1. 直接通信方式
    1. 发送进程使用OS提供的发送命令，直接把消息发送给目标进程，要求发送进程和接收进程都以显式方式提供对方的标识符
2. 间接通信方式
    1. 进程之间的通信需要通过作为共享数据结构的实体。该实体用来发送进程发送给目标进程的消息，接收进程则从该实体中取出对方发送给自己的消息。利用信箱通信的方式， 既可实现实时通信，又可实现非实时通信。
    2. 信箱的分类
        1. 私用信箱：用户进程可为自己建立一个新信箱，并作为该进程的一部分。
            * 信箱的拥有者有权从信箱中读取消息，其他用户则只能将自己构成的消息发送到该信箱中。这种私用信箱可采用单向通信链路的信箱来实现。当拥有该信箱的进程结束时，信箱也随之消失。
        2. 公用信箱：由操作系统创建，并提供给系统中的所有核准进程使用。
            * 核准进程既可把消息发送到该信箱中，也可从信箱中读取发送给自己的消息。显然，公用信箱应采用双向通信链路的信箱来实现。通常，公用信箱在系统运行期间始终存在。
        3. 共享信箱：由某进程创建，在创建时或创建后指明它是可共享的，同时须指出共享进程(用户)的名字。信箱的拥有者和共享者都有权从信箱中取走发送给自己的消息。

### 消息传递系统实现中的若干问题
1. 通信链路的建立方式
    1. 由发送进程在通信之前用显式的“建立连接”命令(原语)请求系统为之建立一条通信链路;在链路使用完后，也用显式方式拆除链路。这种方式主要用于计算机网络中。
    2. 发送进程无须明确提出建立链路的请求，只须利用系统提供的发送命令(原语)，系统会自动地为之建立一条链路。这种方式主要用于单机系统中。
2. 通信链路的连接方法
    1. 点—点连接通信链路，这时的一条链路只连接两个结点(进程);
    2. 多点连接链路，指用一条链路连接多个(n>2)结点(进程)。
3. 通信链路的通信方式
    1. 单向通信链路，只允许发送进程向接收进程发送消息，或者相反。
    2. 双向链路，既允许由进程A向进程B 发送消息，也允许进程B同时向进程A发送消息。
4. 通信链路的链路容量
    1. 无容量通信链路：链路上没有缓冲区，不能暂存任何消息。
    2. 有容量通信链路：通信链路上设置了缓冲区，可以暂存消息。缓冲区数目越大，通信链路的容量愈大。
5. 消息的格式
    1. 定长消息格式：减少了对消息的处理和存储开销。这种方式可用于办公自动化系统中，为用户提供快速的便笺式通信;但这对要发送较长消息的用户是不方便的。
    2. 变长的消息格式：进程所发送消息的长度是可变的。系统无论在处理还是在存储变长消息时，都可能会付出更多的开销，但这方便了用户。
6. 进程同步方式
    1. 发送进程阻塞，接收进程阻塞
        - 这种情况主要用于进程之间紧密同步，发送进程和接收进程之间无缓冲时。这两个进程平时都处于阻塞状态，直到有消息传递时。这种同步方式称为汇合。
    2. 发送进程不阻塞，接收进程阻塞
        - 平时，发送进程不阻塞，因而它可以尽快地把一个或多个消息发送给多个目标; 而接收进程平时则处于阻塞状态，直到发送进程发来消息时才被唤醒。
    3. 发送进程和接收进程都不阻塞
        - 平时，发送进程和接收进程都在忙于自己的事情，仅当发生某事件使它无法继续运行时，才把自己阻塞起来等待。

### 消息缓冲队列通信机制
1. 消息缓冲队列通信机制中的数据结构
    1. 消息缓冲区
    2.  PCB中有关通信的数据项
2. 发送原语
    1. 调用发送原语，把消息发送给目标(接收)进程。发送原语首先根据发送区a中所设置的消息长度a.size来申请一缓冲区i，接着把发送区a中的信息复制到缓冲区i中。为了能将i挂在接收进程的消息队列mq上，应先获得接收进程的内部标识符j，然后将i挂在 j.mq上。
3. 接收原语
    1. 接收进程调用接收原语receive(b)，从自己的消息缓冲队列mq中摘下第一个消息缓冲区 ，并将其中的数据复制到以b为首址的指定消息接收区内。